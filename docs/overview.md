# Качалка — обзор проекта

Короткий документ для передачи в разработку: что сделано, как работает, где менять.

## Что сделано

### Основной функционал
- «Качалка»: показ заданий, проверка ответа, показ решения, поддержка LaTeX.
- Последовательный режим («Пробники»): список заданий без ответов, проход по порядку, прогресс, итоги.
- Ручная проверка для сложных заданий:
  - Математика профиль №13–19
  - Химия №29+
- Итоговый экран с суммой баллов и таблицей результатов.
- Подарок на 5‑м задании (один раз за сессию).

### База заданий
- `tasks.json` содержит задания с расширенной моделью:
  - `id`, `question`, `answer`, `solution`
  - `subject`, `examTaskNumber`, `examType`, `variant`, `subtopic`
  - `imageUrl`, `solutionImageUrl`
- Добавлены пакеты заданий по профильной математике, химии, биологии (вариант 1).

### Админка и аналитика
- Админка задач: список/редактирование/удаление/импорт из JSON, загрузка картинок.
- Аналитика: трекинг событий в `analytics.jsonl`, просмотр в `admin-analytics.html`.

### Картинки
- Поддержка картинок к заданиям и решениям.
- В «Качалке» картинка открывается в модальном окне (увеличение).

## Как работает

### Сервер (Go)
- Запуск: `go run main.go`
- API:
  - `GET /api/task` — случайное задание по фильтрам
  - `POST /api/check` — проверка ответа
  - `POST /api/solution` — решение + `solutionImageUrl`
  - `GET /api/tasks-public` — список задач без ответов (для пробников)
  - `GET /api/filters` — набор фильтров
  - `POST /api/track` — анонимные события
  - `GET /api/analytics` — выгрузка аналитики
- Статика: `static/` (страницы и ресурсы)

### Клиент (static/index.html)
- Режим «Отдельные задания»:
  - `count` задает количество
  - случайная выдача через `/api/task`
- Режим «Пробники»:
  - `sequence=1`
  - список задач через `/api/tasks-public`
  - ход по порядку, отдельная логика прогресса
- Ручные задания:
  - скрывается авто‑проверка
  - показывается ввод баллов
- Подарок:
  - показывается один раз на 5‑м выполненном задании
  - флаг хранится в `sessionStorage`

### Фильтры (static/filters.html)
- Выбор предмета, номера задания, количества.
- Количество заданий в пробниках фиксировано:
  - Русский — 27
  - Математика профиль — 19
  - Биология — 28
  - Химия — 34
- В «Отдельных заданиях» список количеств подстраивается под реальное число задач.

## Где менять

### Логика заданий/проверки
- `main.go`:
  - модели данных (`Task`, `TaskPublic`)
  - фильтрация (`filterTasks`)
  - API роуты

### Контент (задания)
- `tasks.json` — все задания, ответы, решения, картинки.
- Импорт:
  - `imports/*.json` — исходники для добавления
  - `tools/pdf_to_tasks.py` — парсер PDF

### UI/UX
- `static/index.html` — основная «Качалка», модалки, логика прохождения.
- `static/filters.html` — план тренировки и фильтры.
- `static/admin.html` — админка задач.
- `static/admin-analytics.html` — аналитика.
- `static/gift.html` — экран подарка.

### Картинки
- `static/uploads/` — загруженные картинки через админку.
- `static/task-images/` — каталоги с импортированными картинками.

## Что важно учесть
- `analytics.jsonl` локальный, в git не добавлять.
- В «Пробниках» логика прохождения зависит от параметра `sequence=1`.
- Для ручных заданий нет автопроверки — только самовыставление баллов.
